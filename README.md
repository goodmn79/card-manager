# Card Manager Application

## Описание

Card Manager - это серверное приложение для управления пользователями, банковскими картами и транзакциями. Оно предоставляет функционал для:

- Управления пользователями (регистрация, аутентификация, ролевое управление)
- Управления банковскими картами (создание, блокировка/разблокировка)
- Установки дневных и месячных лимитов на операции по картам
- Обработки транзакций с проверкой лимитов
- Обработки запросов пользователей на блокировку/разблокировку карт

## Технологии

- **Spring Boot** - основной фреймворк приложения
- **Spring Security** - аутентификация и авторизация
- **JWT** (JSON Web Tokens) - механизм аутентификации
- **Spring Data JPA** - работа с базой данных
- **Liquibase** - управление миграциями базы данных
- **PostgreSQL** - основная база данных (H2 для тестов)
- **SpringDoc OpenAPI** - документация API
- **Jasypt** - шифрование конфиденциальных данных
- **Docker** - контейнеризация приложения

## Требования

- Java 17+
- Docker и Docker Compose (для запуска в контейнерах)
- PostgreSQL (если запускается без Docker)

## Установка и запуск

### 1. Настройка окружения

Создайте файл `.env` в корне проекта со следующими переменными:

```properties
# Настройки приложения
SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/card_manager
SPRING_DATASOURCE_USERNAME=postgres
SPRING_DATASOURCE_PASSWORD=your_strong_password
POSTGRES_DB=card_manager

# Настройки администратора
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin123
ADMIN_FIRST_NAME=Admin
ADMIN_MIDL_NAME=Adminovich
ADMIN_LAST_NAME=Administrator

# JWT и шифрование
JWT_SECRET=your_jwt_secret_key
JASYPT_ENCRYPTOR_PASSWORD=your_encryption_password
```

### 2. Запуск с помощью Docker Compose

```bash
docker-compose up --build
```

Приложение будет доступно по адресу: `http://localhost:8000`

### 3. Ручной запуск (без Docker)

1. Убедитесь, что PostgreSQL запущен и настроен согласно параметрам в `.env`
2. Соберите и запустите приложение:

```bash
./mvnw spring-boot:run
```

Приложение будет доступно по адресу: `http://localhost:8080`

## API Документация

После запуска приложения документация API доступна по адресу:

- Swagger UI: `http://localhost:8000/swagger-ui.html`
- OpenAPI JSON: `http://localhost:8000/v3/api-docs`

## Функциональность

### Пользователи

- Регистрация новых пользователей
- Аутентификация (JWT)
- Ролевое управление (ADMIN, USER)
- Просмотр и редактирование профиля

### Карты

- Создание новых карт
- Просмотр списка карт
- Блокировка/разблокировка карт
- Установка дневных и месячных лимитов
- Просмотр истории операций по карте

### Транзакции

- Выполнение транзакций
- Проверка лимитов
- История транзакций
- Фильтрация транзакций по дате, типу и т.д.

### Запросы

- Создание запросов на блокировку/разблокировку карт
- Просмотр статуса запросов
- Обработка запросов администратором

## Структура базы данных

Миграции базы данных управляются с помощью Liquibase. Все изменения находятся в `src/main/resources/db/changelog`.

## Тестирование

Для запуска тестов:

```bash
./mvnw test
```

Тесты используют встроенную базу данных H2.